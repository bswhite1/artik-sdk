CMAKE_MINIMUM_REQUIRED	( VERSION 2.8 )
PROJECT			( artik-api-coap C )

PKG_CHECK_MODULES ( COAP REQUIRED libcoap-1 )

add_definitions(-DWITH_POSIX)

SET ( LIB_COAP artik-sdk-coap CACHE INTERNAL "" FORCE )
SET ( ARTIK_COAP_INCLUDE_DIR ${LIB_INC}/coap CACHE INTERNAL "" FORCE )
SET ( ARTIK_COAP_LIBRARIES ${LIB_COAP} CACHE INTERNAL "" FORCE )

SET ( SRC_COAP
	artik_coap.c
	linux/linux_coap.c
	linux/coap_list.c
	cpp/artik_coap.cpp
)

INCLUDE_DIRECTORIES ( ${CMAKE_CURRENT_SOURCE_DIR} linux )

ADD_LIBRARY ( ${LIB_COAP} SHARED ${SRC_COAP} )

TARGET_LINK_LIBRARIES ( ${LIB_COAP}
							${LIB_BASE}
							${COAP_LIBRARIES}
)

TARGET_INCLUDE_DIRECTORIES ( ${LIB_COAP} PUBLIC
							${ARTIK_BASE_INCLUDE_DIR}
							${ARTIK_COAP_INCLUDE_DIR}
							${COAP_INCLUDE_DIRS}
							${ARTIK_BASE_INCLUDE_DIR}/cpp
							${ARTIK_COAP_INCLUDE_DIR}/cpp
)

SET_TARGET_PROPERTIES ( ${LIB_COAP} PROPERTIES VERSION ${LIB_VERSION_MAJOR}.${LIB_VERSION_MINOR}.${LIB_VERSION_PATCH} SOVERSION ${LIB_VERSION_MAJOR} OUTPUT_NAME ${LIB_COAP} )

INSTALL ( TARGETS ${LIB_COAP} LIBRARY DESTINATION "${CMAKE_INSTALL_LIBDIR}" )
FILE ( GLOB COAP_HEADERS "${LIB_INC}/coap/*.h" )
FILE ( GLOB COAP_HEADERS_CPP "${LIB_INC}/coap/cpp/*.hh" )
INSTALL ( FILES ${COAP_HEADERS} DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}/artik/coap" )
INSTALL ( FILES ${COAP_HEADERS_CPP} DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}/artik/coap/cpp" )
